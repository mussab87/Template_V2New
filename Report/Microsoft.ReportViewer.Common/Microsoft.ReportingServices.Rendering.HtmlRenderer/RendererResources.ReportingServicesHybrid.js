var RSHybrid=function(module){module.Constants={localStorageName:"storage",localStorageEventName:"onstorage",closeAuthWindowPropertyName:"RSCloseAuthWindow",closeAuthWindowPropertyValue:"true",reportItemAttr:"data-reportitem",reportItemUrlAttr:"data-reportitemurl",divElement:"DIV",existingDashboardsSelector:"#iSelectDashboards",existingGroupSelector:"#iSelectGroups",pinDialogPinButtonSelector:"#iPinDialogPinBtn",hiddenReportUrlSelector:"input[name=ReportUrlForPinning]",resizeWidthClassName:"resize100Width",resizeHeightClassName:"resize100Height",pinnableItemSelector:'*[data-name="msrs-pinnable"]'};module.ServerResultEnum={SUCCESS:200,FAIL:299};module.extendObject=function(childObject,parentObject){var tempObject=function(){};tempObject.prototype=parentObject.prototype;childObject.prototype=new tempObject;childObject.prototype.constructor=childObject;childObject.baseConstructor=parentObject};var msBetweenPolls=300;var msTimeout=6e4;module.DelayUntilHelper=function(customOptions){if(!customOptions.action)throw new Error("DelayUntilHelper requires an 'action' callback");if(!customOptions.waitUntilTrue)throw new Error("DelayUntilHelper requires a 'waitUntilTrue' function to poll on");this.options=customOptions};module.DelayUntilHelper.prototype.start=function(){var self=this;self.timer=setInterval(function(){if(self.options.waitUntilTrue()){clearInterval(self.timer);clearInterval(self.stopTimer);self.options.action()}},msBetweenPolls);self.stopTimer=setInterval(function(){clearInterval(self.timer);clearInterval(self.stopTimer);if(self.options.onTimeout)self.options.onTimeout()},msTimeout)};module.StorageHelper=function(){var instance=null;function storageHelperInstance(){var self=this;self.action=function(e){};self.oneTimelistener=function(e,self){if(!self.action)return;if(self.action(e)){self.unsubscribe();self.action=null}};self.getLocalStorage=function(){return localStorage};self.callback=function(e){self.oneTimelistener(e,self)};self.subscribe=function(){if(window.addEventListener)window.addEventListener(module.Constants.localStorageName,self.callback,false);else window.attachEvent(module.Constants.localStorageEventName,self.callback)};self.unsubscribe=function(){if(window.removeEventListener)window.removeEventListener(module.Constants.localStorageName,self.callback,false);else if(window.detachEvent)window.detachEvent(module.Constants.localStorageEventName,self.callback)};return{supportsStorage:function(){try{return self.getLocalStorage()!=null}catch(exception){return false}},listenUntilTrue:function(action){if(!action)throw new Error("Call to listenUntil need to specify action");if(typeof action!=="function")throw new Error("Call to listenUntil need to specify action as function");self.action=action;self.subscribe()},getItem:function(key){return self.getLocalStorage().getItem(key)},setItem:function(key,value){return self.getLocalStorage().setItem(key,value)},removeItem:function(key){self.getLocalStorage().removeItem(key)},clear:function(){return self.getLocalStorage().clear()}}}function getInstance(){if(!instance)instance=new storageHelperInstance;return instance}return{supportsStorage:function(){return getInstance().supportsStorage()},listenUntilTrue:function(action){getInstance().listenUntilTrue(action)},getItem:function(key){return getInstance().getItem(key)},setItem:function(key,value){getInstance().setItem(key,value)},removeItem:function(key){getInstance().removeItem(key)},clear:function(){getInstance().clear()}}}();module.PopupBlockerChecker=function(){return{check:function(popup_window,options){var timeout=200;function is_popup_blocked(popup_window,options){if(popup_window.innerHeight>0===false){options.onPopBlockerError();return true}return false}if(/trident/.test(navigator.userAgent.toLowerCase())||/edge/.test(navigator.userAgent.toLowerCase()))return;if(popup_window)if(/chrome/.test(navigator.userAgent.toLowerCase()))setTimeout(function(){return is_popup_blocked(popup_window,options)},timeout);else popup_window.onload=function(){return is_popup_blocked(popup_window,options)};else{options.onPopBlockerError();return true}}}}();module.decodeHtmlText=function(textToDecode){return window.$RSjQuery("<div/>").html(textToDecode).text()};return module}(RSHybrid||{});var RSHybrid=function(module){module.WebRequests=function(customOptions){var options=window.$RSjQuery.extend({get:window.$RSjQuery.get,ajax:window.$RSjQuery.ajax},customOptions);this.options=options;window.$RSjQuery.ajaxSetup({cache:false})};module.WebRequests.prototype.checkUserAccess=function(url){var params={Action:"CheckUserAccess"};return this.options.ajax(url,{data:params})};module.WebRequests.prototype.getExistingDashboards=function(url,groupId){var params={Action:"GetDashboards",GroupId:groupId};return this.options.get(url,params)};module.WebRequests.prototype.getExistingGroups=function(url){var params={Action:"GetGroups"};return this.options.get(url,params)};module.WebRequests.prototype.addToPBIDashboardsRequest=function(url,pinSettings){var params={OutputFormat:"PNG",PinSettings:pinSettings,Action:"AddToDashboards"};return this.options.get(url,params)};return module}(RSHybrid||{});var RSHybrid=function(module){module.OkCancelDialog=function(){};module.OkCancelDialog.prototype.show=function(title,message,okButtonText,okAction,cancelButtonText,cancelAction,closeAction){if("undefined"==typeof closeAction)closeAction=new function(){};var outer=window.$RSjQuery("body");if(window.$RSjQuery("body #okCancelDialog").length)window.$RSjQuery("#okCancelDialog").remove();var resultDlg=window.$RSjQuery("<div>",{id:"okCancelDialog",dialogClass:"cOkCancelDialog",title:RSHybrid.decodeHtmlText(title),html:message});outer.append(resultDlg);resultDlg.dialog({autoOpen:true,width:420,modal:true,beforeClose:closeAction,buttons:[{html:okButtonText,"class":"cOkButton",id:"iResult_OkButton",click:function(){okAction();resultDlg.dialog("close")}},{html:cancelButtonText,"class":"cCancelButton",id:"iResult_CancelButton",click:function(){cancelAction();resultDlg.dialog("close")}}]})};return module}(RSHybrid||{});var RSTelemetry;var RSHybrid=function(module){var closeDialogMethodName="close";var dialogSelector="#iPinToDashboard";var dialogMaskId="iCoverPinToDashboard";var dialogMaskSelector="#"+dialogMaskId;var closeDialogSelector="#RS-Hybrid-Pin-close";var maxCharactersInDashboardNameToShow=42;var lastSelectedGroup="";var getExistingDashboardName=function(){return window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector+" option:selected").text()};var getExistingDashboardId=function(){return window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector+" option:selected").attr("value")};var getUpdateFrequency=function(){return window.$RSjQuery("#iSelectUpdateFrequency option:selected").attr("id")};var getSelectedGroupId=function(){return window.$RSjQuery(RSHybrid.Constants.existingGroupSelector+" option:selected").attr("value")};var getSuccessMessage=function(response){var doneResult=RSHybrid.strings.pinResultDialogSuccessMessage;doneResult=doneResult.replace("{0}",response.dashboardName);var dashboardLink=RSHybrid.strings.pinResultDialogSuccessLinkText;dashboardLink="&nbsp;<br><br><a class='pinAnchor' target='_blank' href='"+response.dashboardUrl+"'>"+dashboardLink+"<\/a>";return doneResult+dashboardLink};module.PinDialog=function(overrideOptions){this.options=window.$RSjQuery.extend({webRequests:new RSHybrid.WebRequests,onExit:function(){}},overrideOptions)};module.PinDialog.prototype.close=function(){window.$RSjQuery(dialogSelector).dialog(closeDialogMethodName)};module.PinDialog.prototype.show=function(selectorForVisualBeingPinned){var self=this;window.$RSjQuery(dialogSelector);window.$RSjQuery(dialogSelector).dialog({autoOpen:true,resizable:false,width:480,modal:true,beforeClose:self.options.onExit,buttons:[{html:RSHybrid.strings.pinDialogPin,width:90,id:"iPinDialogPinBtn",click:function(e){self.addToPBIDashboards(selectorForVisualBeingPinned);var $outerDialog=window.$RSjQuery(dialogSelector).parent();var $cover=window.$RSjQuery("#iCoverPinToDashboard").css({height:$outerDialog.outerHeight()+1,width:$outerDialog.outerWidth()+1,top:$outerDialog.offset().top,left:$outerDialog.offset().left}).show();var $spinny=window.$RSjQuery("#spinnyIcon").css({left:window.$RSjQuery("#iPinDialogPinBtn").position().left-30+"px",top:window.$RSjQuery("#iPinDialogPinBtn").position().top+window.$RSjQuery("#iPinDialogPinBtn").height()+"px"}).appendTo($cover);$outerDialog.parent().append($cover)},"class":"cPinButton"},{html:RSHybrid.strings.pinDialogCancel,"class":"cCancelButton",width:90,click:function(){self.close()}}]});window.$RSjQuery(".ui-dialog .ui-dialog-titlebar-close").css({"background-image":'url("'+RSHybrid.resources.closeImage+'")'});window.$RSjQuery("#iSelectUpdateFrequency").val("Daily");window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).empty();window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).append("<option selected disabled>"+RSHybrid.strings.pinDialogLoadingDashboards+"<\/option>");window.$RSjQuery(RSHybrid.Constants.existingGroupSelector).empty();window.$RSjQuery(RSHybrid.Constants.existingGroupSelector).append("<option selected disabled>"+RSHybrid.strings.pinDialogLoadingGroups+"<\/option>");var url=RSHybrid.getReportItemUrl()||"";self.options.webRequests.getExistingGroups(url).always(function(result,textStatus,jqXHR){switch(jqXHR.status){case RSHybrid.ServerResultEnum.SUCCESS:window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).empty();window.$RSjQuery(RSHybrid.Constants.existingGroupSelector).empty();var output=[];output.push('<option value="myworkspace" title="'+RSHybrid.strings.pinDialogMyWorkspaceName+'">'+RSHybrid.strings.pinDialogMyWorkspaceName+"<\/option>");if(typeof result!==undefined&&result.length>0){result.sort(function(a,b){var al=a.DisplayName.toLocaleLowerCase();var bl=b.DisplayName.toLocaleLowerCase();return al<bl?-1:al>bl?1:0});for(var i in result){var displayName=result[i].DisplayName;var shortDisplayName=displayName;if(shortDisplayName.length>maxCharactersInDashboardNameToShow)shortDisplayName=shortDisplayName.substring(0,maxCharactersInDashboardNameToShow)+"...";output.push('<option value="'+result[i].Id+'" title="'+displayName+'">'+shortDisplayName+"<\/option>")}}window.$RSjQuery(RSHybrid.Constants.existingGroupSelector).html(output.join(""));lastSelectedGroup="";self.updateDashboardDropdown();window.$RSjQuery(RSHybrid.Constants.existingGroupSelector).change(function(){self.updateDashboardDropdown()});break;case RSHybrid.ServerResultEnum.FAIL:self.options.onError(jqXHR.responseText);self.close();break;default:self.options.onError("UNEXPECTED: "+jqXHR.responseText);self.close();break}})};module.PinDialog.prototype.updateDashboardDropdown=function(){var self=this;var url=RSHybrid.getReportItemUrl()||"";var currentSelectedGroupId=getSelectedGroupId();if(lastSelectedGroup===currentSelectedGroupId)return;lastSelectedGroup=currentSelectedGroupId;window.$RSjQuery(RSHybrid.Constants.pinDialogPinButtonSelector).button("disable");window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).empty();window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).append("<option selected disabled>"+RSHybrid.strings.pinDialogLoadingDashboards+"<\/option>");self.options.webRequests.getExistingDashboards(url,getSelectedGroupId()).always(function(result,textStatus,jqXHR){switch(jqXHR.status){case RSHybrid.ServerResultEnum.SUCCESS:if(result.length>0){result.sort(function(a,b){var al=a.DisplayName.toLocaleLowerCase();var bl=b.DisplayName.toLocaleLowerCase();return al<bl?-1:al>bl?1:0});var output=[];for(var i in result){var displayName=result[i].DisplayName;var shortDisplayName=displayName;if(shortDisplayName.length>maxCharactersInDashboardNameToShow)shortDisplayName=shortDisplayName.substring(0,maxCharactersInDashboardNameToShow)+"...";output.push('<option value="'+result[i].Id+'" title="'+displayName+'">'+shortDisplayName+"<\/option>");window.$RSjQuery(RSHybrid.Constants.pinDialogPinButtonSelector).button("enable")}window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).empty();window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).html(output.join(""))}else{window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).empty();window.$RSjQuery(RSHybrid.Constants.existingDashboardsSelector).append("<option selected disabled>"+"No pinable dashboards in this group"+"<\/option>")}break;case RSHybrid.ServerResultEnum.FAIL:self.options.onError(jqXHR.responseText);self.close();break;default:self.options.onError("UNEXPECTED: "+jqXHR.responseText);self.close();break}})};module.PinDialog.prototype.addToPBIDashboards=function(selectorForLastVisitedVisual){var self=this;var url=RSHybrid.getReportItemUrl(selectorForLastVisitedVisual);var pinSettings=self.getPinSettings();var jqxhr=self.options.webRequests.addToPBIDashboardsRequest(url,pinSettings);jqxhr.always(function(data,textStatus,jqXHR){window.$RSjQuery(dialogMaskSelector).remove();self.close();self.showResult(jqXHR)})};module.PinDialog.prototype.showResult=function(jqXHR){switch(jqXHR.status){case RSHybrid.ServerResultEnum.SUCCESS:var msg=getSuccessMessage(jqXHR.responseJSON);RSHybrid.resultDialog.show(RSHybrid.strings.pinResultDialogSuccessTitle,msg,RSHybrid.strings.pinDialogClose);break;case RSHybrid.ServerResultEnum.FAIL:RSHybrid.resultDialog.show(RSHybrid.strings.pinResultDialogErrorTitle,jqXHR.responseText,RSHybrid.strings.pinDialogClose);break;default:RSHybrid.resultDialog.show(RSHybrid.strings.pinResultDialogErrorTitle,"UNEXPECTED: "+jqXHR.responseText,RSHybrid.strings.pinDialogClose)}if(RSTelemetry)RSTelemetry.trackEvent("RS.ReportViewer.ShowPinningResultDialog",{ServerResultCode:jqXHR.status})};module.PinDialog.prototype.getPinSettings=function(){var settings=new RSHybrid.PinSettings;settings.dashboardName=getExistingDashboardName();settings.dashboardId=getExistingDashboardId();settings.frequencyOfUpdate=getUpdateFrequency();settings.groupId=getSelectedGroupId();return settings};return module}(RSHybrid||{});var RSHybrid=function(module){var errorResultSelector="#errorResult";var doneResultSelector="#doneResult";var popupErrorResultSelector="#popupBlockerError";var errorMessageSelector="#diagBodyText";module.ResultDialog=function(overrideOptions){this.options=window.$RSjQuery.extend({onExit:function(){}},overrideOptions)};module.ResultDialog.prototype.show=function(title,message,buttonText){var self=this;var $outer=window.$RSjQuery("body");if(window.$RSjQuery("body #fullReusibleDialog").length)window.$RSjQuery("#fullReusibleDialog").remove();var $resultDlg=window.$RSjQuery("<div>",{id:"fullReusibleDialog",dialogClass:"cResultDialog",title:RSHybrid.decodeHtmlText(title),html:message});$outer.append($resultDlg);$resultDlg.dialog({autoOpen:true,width:440,modal:true,beforeClose:self.options.onExit,buttons:[{html:buttonText,"class":"cCancelButton",id:"iResult_CloseButton",click:function(){$resultDlg.dialog("close")}}]})};module.ResultDialog.prototype.close=function(){window.$RSjQuery("#fullReusibleDialog").dialog("close")};return module}(RSHybrid||{});var RSHybrid=function(module){module.PinSettings=function(){this.dashboardName="";this.frequencyOfUpdate="";this.dashboardId="";this.groupId=""};return module}(RSHybrid||{});var RSTelemetry;var RSHybrid=function(module){module.AuthPopupManager=function(customOptions){this.options=window.$RSjQuery.extend({window:window,aadAuthUrl:RSHybrid.aadAuthUrl,onError:function(){},onCancel:function(){},afterAuth:function(){},authWindowTitle:"Login",authWindowOptions:"resizable,scrollbars,status",windowWidth:420,windowHeight:600,loginSucceeded:false,storageHelper:RSHybrid.StorageHelper,webRequests:new RSHybrid.WebRequests},customOptions)};var showLoginDialog=function(window,desiredWindowWidth,desiredWindowHeight,authWindowOptions,aadAuthUrl,authWindowTitle){if(RSTelemetry)RSTelemetry.trackEvent("RS.ReportViewer.StartPinningLogin");var newWindowOptions="width="+desiredWindowWidth+","+"height="+desiredWindowHeight+",";if(window.screenX&&window.screenY){var popupX=window.screenX+.5*window.$RSjQuery(window).width()-.5*desiredWindowWidth;var popupY=window.screenY+.5*window.$RSjQuery(window).height()-.5*desiredWindowHeight;newWindowOptions=newWindowOptions+"left="+popupX+","+"top="+popupY+","}newWindowOptions=newWindowOptions+authWindowOptions;var newWindow=window.open(aadAuthUrl,authWindowTitle,newWindowOptions);if(newWindow&&newWindow.focus)newWindow.focus()};module.AuthPopupManager.prototype.openLoginDialog=function(){options=this.options;newWindow=showLoginDialog(options.window,options.windowWidth,options.windowHeight,options.authWindowOptions,options.aadAuthUrl,options.authWindowTitle)};module.AuthPopupManager.prototype.logIn=function(){var self=this;var options=self.options;var newWindow;var authOkDialog=new RSHybrid.OkCancelDialog;authOkDialog.show(RSHybrid.strings.pinSignInDialogWindowTitle,RSHybrid.FwLinkMessage(RSHybrid.strings.pinSignInDialogWindowText,RSHybrid.strings.pinSignInDialogWindowLinkText,RSHybrid.pbiSignupFwLink),RSHybrid.strings.pinSignInDialogSignIn,function(){newWindow=showLoginDialog(options.window,options.windowWidth,options.windowHeight,options.authWindowOptions,options.aadAuthUrl,options.authWindowTitle)},RSHybrid.strings.pinSignInDialogCancel,options.onCancel);if(/(MSIE 10.0)|(edge)/.test(navigator.userAgent.toLowerCase())){var delayUtil=new RSHybrid.DelayUntilHelper({action:function(){options.storageHelper.removeItem(RSHybrid.Constants.closeAuthWindowPropertyName);options.afterAuth()},waitUntilTrue:function(){var url=window.$RSjQuery(RSHybrid.Constants.hiddenReportUrlSelector).val();options.webRequests.checkUserAccess(url).done(function(result){options.loginSucceeded=result}).fail(function(data,textStatus,jqXHR){options.onError(jqXHR.responseText)});return options.loginSucceeded},onTimeout:function(){if(newWindow)newWindow.close()},document:options.window.document});delayUtil.start()}else options.storageHelper.listenUntilTrue(function(e){if(e.key===RSHybrid.Constants.closeAuthWindowPropertyName&&e.newValue===RSHybrid.Constants.closeAuthWindowPropertyValue){options.storageHelper.removeItem(RSHybrid.Constants.closeAuthWindowPropertyName);options.afterAuth();return true}return false})};module.AuthPopupManager.prototype.close=function(){var win=this.options.window;RSHybrid.StorageHelper.setItem(RSHybrid.Constants.closeAuthWindowPropertyName,RSHybrid.Constants.closeAuthWindowPropertyValue);win.open("","_self","");win.close()};return module}(RSHybrid||{});var RSHybrid=function(module){var getReportArea=function(){var $element=window.$RSjQuery(RSHybrid.PinningUIConstants.reportAreaSelector);$element=$element.parent().parent();return $element};var getReportContainerWithScrollBar=function(){var $element=window.$RSjQuery(RSHybrid.PinningUIConstants.reportAreaSelector);$element=$element.parent();return $element};var getToolbarHeight=function(){var $toolbar=window.$RSjQuery(RSHybrid.PinningUIConstants.toolbarSelector);return $toolbar.offset().top+$toolbar.outerHeight()};var getDocumentMapWidth=function(){var $documentMap=window.$RSjQuery(RSHybrid.PinningUIConstants.documentMapSelector);if(typeof $documentMap==="undefined"||typeof $documentMap.offset()==="undefined")return 0;else return $documentMap.offset().left+$documentMap.width()+1};var enterPinningModeUIChanges=function(toolbarMaskId,documentMapMaskId,reportMaskId,fakeReportId,headerId){window.$RSjQuery("#"+toolbarMaskId).show();window.$RSjQuery("#"+documentMapMaskId).show();window.$RSjQuery("#"+reportMaskId).show();window.$RSjQuery("#"+fakeReportId).show();window.$RSjQuery("#"+headerId).css("display","flex")};var exitPinningModeUIChanges=function(toolbarMaskId,documentMapMaskId,reportMaskId,fakeReportId,headerId){window.$RSjQuery("#"+toolbarMaskId).hide();window.$RSjQuery("#"+documentMapMaskId).hide();window.$RSjQuery("#"+reportMaskId).hide();window.$RSjQuery("#"+fakeReportId).hide();window.$RSjQuery("#"+headerId).hide()};var attachPinningListeners=function(manager){window.$RSjQuery(RSHybrid.Constants.pinnableItemSelector).each(function(){var node=window.$RSjQuery(this);if(node[0].nodeName.toUpperCase()==="img".toUpperCase())node=node.parent();node.addClass(RSHybrid.PinningUIConstants.activePinClass);node.attr("title",RSHybrid.strings.pinHoverTitle);node.on({click:function(event){manager.openPinDialog(window.$RSjQuery(this));event.preventDefault();event.stopPropagation()}})});window.$RSjQuery(document).keyup(function(e){if(e.keyCode==27)manager.exitPinningMode()})};var resizeReportMask=function(){var $toolbarMask=window.$RSjQuery("#"+RSHybrid.PinningUIConstants.toolbarMaskId);var $documentMapMask=window.$RSjQuery("#"+RSHybrid.PinningUIConstants.documentMapMaskId);var $reportMask=window.$RSjQuery("#"+RSHybrid.PinningUIConstants.reportMaskId);var $fakeReport=window.$RSjQuery("#"+RSHybrid.PinningUIConstants.fakeReportId);$toolbarMask.height(getToolbarHeight());$documentMapMask.css("top",$toolbarMask.outerHeight());$documentMapMask.width(getDocumentMapWidth());var $report=window.$RSjQuery(RSHybrid.PinningUIConstants.reportAreaSelector).children(":first");$reportArea=getReportArea();$reportMask.css("top",$reportArea.offset().top);$reportMask.css("left",$reportArea.offset().left);var reportMaskHeight=window.innerHeight-$reportArea.offset().top;var reportMaskWidth=window.innerWidth-$reportArea.offset().left;$reportMask.height(reportMaskHeight);$reportMask.width(reportMaskWidth);$fakeReport.css({height:$report.parent().prop("scrollHeight"),width:$report.parent().prop("scrollWidth")})};var detachPinningListeners=function(){var activePinSelector="."+RSHybrid.PinningUIConstants.activePinClass;window.$RSjQuery(activePinSelector).off();window.$RSjQuery(activePinSelector).attr("title","");window.$RSjQuery(activePinSelector).removeClass("activePin");window.$RSjQuery(window).unbind("resize",resizeReportMask)};var closeButtonHandler=function(manager){manager.exitPinningMode()};module.PinManager=function(customOptions){var self=this;self.options=window.$RSjQuery.extend({window:window,pinningModeInitialized:false,pinningModeEnabled:false,mask:"pinningModeMask",leavePinningModeButton:"leavePinningModeButton",powerBIBanner:"powerBIBanner"},customOptions)};module.PinningUIConstants={toolbarMaskId:"toolbarMask",documentMapMaskId:"documentMapMask",reportMaskId:"reportMask",fakeReportId:"clonedReport",leavePinningModeButtonId:"leavePinningModeButton",headerId:"pinningModeHeader",activePinClass:"activePin",toolbarSelector:".ToolBarButtonsCell",reportAreaSelector:"[id^=VisibleReportContent]",documentMapSelector:'input[title="Show / Hide Document Map"]'};module.PinManager.prototype.openPinDialog=function(elementToPin){RSHybrid.pinDialog.show(elementToPin)};module.PinManager.prototype.enterPinningMode=function(donePinningCallback){var self=this;if(self.options.pinningModeEnabled)return;if(RSHybrid.strings.pinHasScheduleReadyDataSources&&RSHybrid.strings.pinHasScheduleReadyDataSources.toLowerCase()!=="true"){RSHybrid.resultDialog.show(RSHybrid.strings.pinResultDialogErrorTitle,RSHybrid.strings.pinResultDialogNoScheduleReadyDataSources,RSHybrid.strings.pinDialogClose);return}if(window.$RSjQuery(RSHybrid.Constants.pinnableItemSelector).length===0){RSHybrid.resultDialog.show(RSHybrid.strings.pinResultDialogErrorTitle,RSHybrid.strings.pinResultDialogNoItemsToPin,RSHybrid.strings.pinDialogClose);return}var doMask=function(){var url=RSHybrid.getReportItemUrl()||"";self.options.webRequests.getExistingDashboards(url).always(function(result,textStatus,jqXHR){switch(jqXHR.status){case RSHybrid.ServerResultEnum.SUCCESS:if(result.length<1)self.options.webRequests.getExistingGroups(url).always(function(result,textStatus,jqResponse){switch(jqResponse.status){case RSHybrid.ServerResultEnum.SUCCESS:if(result.length<1){RSHybrid.resultDialog.show(RSHybrid.strings.pinNoDashboardsTitle,RSHybrid.FwLinkMessage(RSHybrid.strings.pinNoDashboards,RSHybrid.strings.pinNoDashboardsLinkText,RSHybrid.pbiDashboardFwLink),RSHybrid.strings.pinDialogClose);return}break;case RSHybrid.ServerResultEnum.FAIL:self.options.onError(jqResponse.responseText);return;default:self.options.onError("UNEXPECTED: "+jqResponse.responseText);return}});self.options.pinningModeEnabled=true;if(!self.options.pinningModeInitialized)self.createElements();enterPinningModeUIChanges(RSHybrid.PinningUIConstants.toolbarMaskId,RSHybrid.PinningUIConstants.documentMapMaskId,RSHybrid.PinningUIConstants.reportMaskId,RSHybrid.PinningUIConstants.fakeReportId,RSHybrid.PinningUIConstants.headerId);self.formatElements();attachPinningListeners(self);break;case RSHybrid.ServerResultEnum.FAIL:self.options.onError(jqXHR.responseText);return;default:self.options.onError("UNEXPECTED: "+jqXHR.responseText);return}})};if(RSHybrid.needToAuthenticate){var url=window.$RSjQuery(RSHybrid.Constants.hiddenReportUrlSelector).val();self.options.webRequests.checkUserAccess(url).always(function(result,textStatus,jqXHR){switch(jqXHR.status){case RSHybrid.ServerResultEnum.SUCCESS:RSHybrid.needToAuthenticate=result===false;if(RSHybrid.needToAuthenticate)self.authenticate(doMask,donePinningCallback);else doMask();break;case RSHybrid.ServerResultEnum.FAIL:self.options.onError(jqXHR.responseText);break;default:self.options.onError(RSHybrid.strings.pinResultDialogErrorTitle,"UNEXPECTED: "+jqXHR.responseText);break}})}else doMask()};module.PinManager.prototype.authenticate=function(doMask,donePinningCallback){var self=this;var authPopupManager=new RSHybrid.AuthPopupManager({window:RSHybrid.window,aadAuthUrl:RSHybrid.aadAuthUrl,afterAuth:function(){doMask();window.$RSjQuery(RSHybrid.Constants.pin4PBISelector).attr(RSHybrid.Constants.reportItemUrlAttr)},onCancel:donePinningCallback});authPopupManager.logIn()};module.PinManager.prototype.exitPinningMode=function(){var self=this;if(!self.options.pinningModeEnabled)return;self.options.pinningModeEnabled=false;exitPinningModeUIChanges(RSHybrid.PinningUIConstants.toolbarMaskId,RSHybrid.PinningUIConstants.documentMapMaskId,RSHybrid.PinningUIConstants.reportMaskId,RSHybrid.PinningUIConstants.fakeReportId,RSHybrid.PinningUIConstants.headerId);detachPinningListeners()};module.PinManager.prototype.formatElements=function(){var self=this;if(!self.options.pinningModeInitialized)return;resizeReportMask();window.$RSjQuery(window).resize(resizeReportMask)};module.PinManager.prototype.createElements=function(){if(this.options.pinningModeInitialized)return;this.options.pinningModeInitialized=true;var self=this;var $outer=window.$RSjQuery("body");var $report=window.$RSjQuery(RSHybrid.PinningUIConstants.reportAreaSelector).children(":first");var $reportArea=$report.parents().eq(2);var $documentMapMask=window.$RSjQuery("<div>",{id:RSHybrid.PinningUIConstants.documentMapMaskId});var $reportMask=window.$RSjQuery("<div>",{id:RSHybrid.PinningUIConstants.reportMaskId});var $fakeReport=window.$RSjQuery("<div>",{id:RSHybrid.PinningUIConstants.fakeReportId});window.$RSjQuery("#"+RSHybrid.PinningUIConstants.leavePinningModeButtonId).on({click:function(){closeButtonHandler(self)}});$reportMask.scroll(function(){$reportArea.children(":first").scrollTop($reportMask.scrollTop());$reportArea.children(":first").scrollLeft($reportMask.scrollLeft())});$reportArea.children(":first").scroll(function(){$reportMask.scrollTop($reportArea.children(":first").scrollTop());$reportMask.scrollLeft($reportArea.children(":first").scrollLeft())});$outer.append($documentMapMask);$reportArea.append($reportMask);$reportMask.append($fakeReport)};return module}(RSHybrid||{});var ko;var RSTelemetry;var RSHybrid=function(module){module.aadAuthUrl="";module.needToAuthenticate=true;module.window=window;module.strings={};module.resultDialog={};module.pinDialog={};module.okCancelDialog={};module.resources={};module.pbiSignupFwLink=624686;module.pbiDashboardFwLink=627462;module.FwLinkMessage=function(message,linkText,linkId){return message+"<br><br>"+"<a class='linkAnchor' target='_blank' href='"+"https://go.microsoft.com/fwlink/?LinkId="+linkId+"'>"+linkText+"<\/a>"};module.getReportItemUrl=function(selectorForLastVisitedVisual){var selectedReportItemName="";if(window.$RSjQuery(selectorForLastVisitedVisual).is(RSHybrid.Constants.divElement))selectedReportItemName=window.$RSjQuery(selectorForLastVisitedVisual).children(":first").attr(RSHybrid.Constants.reportItemAttr);else selectedReportItemName=window.$RSjQuery(selectorForLastVisitedVisual).attr(RSHybrid.Constants.reportItemAttr);return window.$RSjQuery(RSHybrid.Constants.hiddenReportUrlSelector).val()+selectedReportItemName};module.App=function(options){var self=this;module.aadAuthUrl=options.aadAuthUrl;module.needToAuthenticate=true;module.window=window;module.strings=options.strings;module.resources=options.resources;module.okCancelDialog=new RSHybrid.OkCancelDialog;module.resultDialog=new RSHybrid.ResultDialog({});module.pinDialog=new RSHybrid.PinDialog({onExit:function(){self.pinManager.exitPinningMode()},onError:function(errorMessage){self.onError(errorMessage)}});this.onError=function(errorMessage){self.pinManager.exitPinningMode();RSHybrid.resultDialog.show(RSHybrid.strings.pinResultDialogErrorTitle,errorMessage,RSHybrid.strings.pinDialogClose)};this.webRequests=options.webRequests;if(typeof this.webRequests==="undefined")this.webRequests=new RSHybrid.WebRequests;this.pinManager=new RSHybrid.PinManager({webRequests:this.webRequests,onError:self.onError});module.App.prototype.stopPinning=function(){self.pinManager.exitPinningMode();self.callerScope=null};var knockoutApplied=false;module.App.prototype.startPinning=function(callerScope){if(RSTelemetry)RSTelemetry.trackEvent("RS.ReportViewer.StartPinning");if(!knockoutApplied){ko.applyBindings(RSHybrid.strings);knockoutApplied=true}self.pinManager.enterPinningMode(this.stopPinning);self.callerScope=callerScope};module.App.prototype.signIn=function(){var authPopupManager=new RSHybrid.AuthPopupManager({window:RSHybrid.window,aadAuthUrl:RSHybrid.aadAuthUrl,onCancel:function(){},afterAuth:function(){__doPostBack("","")},url:window.$RSjQuery(RSHybrid.Constants.pin4PBISelector).attr(RSHybrid.Constants.reportItemUrlAttr)});authPopupManager.logIn();return false}};return module}(RSHybrid||{});